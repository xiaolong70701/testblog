{
  "hash": "dd685bbe645d74909360d9892f201683",
  "result": {
    "markdown": "---\ntitle: \"Acessando dados do seu One Drive com R\"\nsubtitle: \"Post publicado no blog da Curso-R.\"\nauthor: \"Beatriz Milz\"\ndate: \"2022-03-18\"\ncategories: [\"API\", \"One Drive\", \"Data import\", \"Excel\", \"Microsoft\", \"Azure\", \"Microsoft365R\"]\nimage: \"featured-hex.png\"\ntoc: true\n---\n\n\n\n\n::: callout-tip\nEsse post foi origalmente publicado no [blog da Curso-R](https://blog.curso-r.com/posts/2022-03-18-onedrive/).\n:::\n\n## Introdução\n\nRecentemente, escrevi um [post sobre como é possível acessar dados do Google Sheets com R](https://blog.curso-r.com/posts/2022-03-08-googlesheets4/), além de importar respostas do Google Forms.\nAlgumas pessoas comentaram que utilizam o One Drive, e perguntaram como funcionaria para importar tabelas que estão por lá.\nComo eu não uso One Drive, dei uma explorada para responder, e neste post falarei um pouco sobre como podemos importar dados que estão na conta do One Drive usando o pacote `Microsoft365R`.\n\nO pacote [Microsoft365R](https://github.com/Azure/Microsoft365R) é uma interface para acessar o Microsoft 365, e segundo a documentação do pacote, possui funções para interagir com o Microsoft Teams, Outlook, SharePoint Online, e o **OneDrive** (que é o foco deste post!).\n\nPrimeiramente, é necessário instalar o pacote:\n\n``` r\ninstall.packages(\"Microsoft365R\")\n```\n\nEntão, podemos carregá-lo:\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-1_fa92d2b94425bfd452f0ac8d77af227d'}\n\n```{.r .cell-code}\n# Carregar pacote Microsoft365R\nlibrary(Microsoft365R)\n```\n:::\n\n\nAo carregar o pacote pela primeira vez, a seguinte mensagem aparecerá, dizendo que é possível armazenar as credenciais em uma pasta chamada `AzureR` e perguntando se permitimos que o pacote crie esse diretório.\nEu aceitei respondendo com `Yes`:\n\n``` r\nThe AzureR packages can save your authentication credentials in the directory:\n\n~/Library/Application Support/AzureR\n\nThis saves you having to re-authenticate with Azure in future sessions.\nCreate this directory? (Yes/no/cancel) \n```\n\nDepois de responder com `Yes`, nada aparentemente acontece, porém o pacote é carregado!\n\n## Autenticação\n\nAo acessar pela primeira vez, o pacote abrirá uma aba do navegador para fazer a autenticação.\n\nNeste exemplo, usarei a função `Microsoft365R::get_personal_onedrive()` que explicarei posteriormente.\nNo console do R, aparecerá a seguinte mensagem ao utilizar alguma função pela primeira vez:\n\n``` r\nMicrosoft365R::get_personal_onedrive()\n# Using authorization_code flow\n# Creating Microsoft Graph login for tenant 'consumers'\n# Using authorization_code flow\n# Waiting for authentication in browser...\n# Press Esc/Ctrl + C to abort\n```\n\nO navegador abrirá uma janela para que a autenticação seja feita:\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-2_e788fda4b2efa3a2f405c656e6fc90cb'}\n::: {.cell-output-display}\n![](img/auth-onedrive.png){width=1436}\n:::\n:::\n\n\nApós fazer a autenticação, a seguinte mensagem aparecerá no navegador:\n\n    Authenticated with Azure Active Directory. Please close this page and return to R.\n\nIsso significa que podemos fechar a aba do navegador e retornar ao R.\nNo console do R, aparecerá a seguinte mensagem:\n\n``` r\nAuthentication complete.\n```\n\n## Acesso de conta pessoal ou de trabalho?\n\nO primeiro passo após autenticar é acessar o One Drive, e a função para fazer isso depende do tipo de acesso da conta: pessoal ou de trabalho.\nComo o meu acesso é pessoal, vou usar a função `get_personal_onedrive()`.\nMas caso o seu acesso seja de trabalho, utilize a função `get_business_onedrive()`.\nÉ necessário executar a função e salvar o resultado em um objeto.\n\n``` r\nonedrive_da_bea <-  Microsoft365R::get_personal_onedrive()\n```\n\nAgora a forma de interagir com o pacote é um pouco diferente de como usamos na maior parte das vezes.\nIsso porque o pacote utiliza objetos que são da classe `R6`, e que permitem utilizar métodos.\nO foco deste post não é explicar o que são as classes R6, e escrevi este post pensando em ser útil para pessoas que também não conhecem as classes R6.\nCaso você tenha interesse em saber mais, deixei alguns links de referência no final do post.\n\nPara conferir a classe desse objeto, podemos usar a função `class()`:\n\n``` r\nclass(onedrive_da_bea)\n#> [1] \"ms_drive\"  \"ms_object\" \"R6\"  \n```\n\nAo executar apenas o objeto, o console apresenta os métodos possíveis:\n\n``` r\ndrive_da_bea\n\n#> <Personal OneDrive of Beatriz Milz>\n#>   directory id: df5a76afb6532845 \n#> ---\n#>   Methods:\n#>     create_folder, create_share_link, delete,\n#>     delete_item, do_operation, download_file,\n#>     get_item, get_item_properties, get_list_pager,\n#>     list_files, list_items, list_shared_files,\n#>     list_shared_items, open_item,\n#>     set_item_properties, sync_fields, update,\n#>     upload_file\n```\n\nSabendo o nome dos métodos, podemos usá-los usando o seguinte padrão: `nome_do_objeto$nome_do_metodo()`!\nExistem vários métodos, e vamos explorar os métodos relacionados à importação.\nMas caso você use bastante o One Drive no seu dia-a-dia, recomendo experimentar os outros métodos, como os que servem para manipular arquivos (como criar, atualizar, deletar)!\n\n## Navegar nos arquivos do Drive\n\nPara conseguir importar um arquivo, é necessário primeiramente encontrar o caminho até este arquivo.\nE isso funciona de forma similar aos caminhos que já conhecemos nos nossos projetos!\nVamos usar o método `list_files()` para listar os arquivos presentes na pasta inicial do meu OneDrive.\nComo eu raramente uso ele, criei uma pasta de exemplo chamada `pasta_de_exemplo`, e dentro dela criei um arquivo Excel chamado `pinguins`.\nVeja que apareceu apenas a pasta, e não o conteúdo que ela armazena:\n\n``` r\nonedrive_da_bea$list_files() |> dplyr::glimpse()\n\n#> Rows: 1\n#> Columns: 4\n#> $ name  <chr> \"pasta_de_exemplo\"\n#> $ size  <int> 23041\n#> $ isdir <lgl> TRUE\n#> $ id    <chr> \"DF5A76AFB6532845!4368\"\n```\n\nPara ver os arquivos que estão dentro da pasta (e encontrar o excel `pinguins`), podemos usar o mesmo método utilizado acima, e informar o nome da pasta que queremos listar os arquivos.\n\n``` r\nonedrive_da_bea$list_files(path = \"pasta_de_exemplo/\") |> dplyr::glimpse()\n\n#> Rows: 1\n#> Columns: 4\n#> $ name  <chr> \"pinguins.xlsx\"\n#> $ size  <int> 23041\n#> $ isdir <lgl> FALSE\n#> $ id    <chr> \"DF5A76AFB6532845!4369\"\n```\n\n## Importar o arquivo\n\nEu ainda não encontrei um método que permita ler o conteúdo de um Excel diretamente do OneDrive para o R (como fazemos com o Google Drive).\nOlhando nas [issues do GitHub](https://github.com/Azure/Microsoft365R), parece que essa funcionalidade ainda não foi implementada até o momento, e algumas pessoas inclusive sugeriram melhorias neste sentido.\n\nA forma que encontrei para importar um Excel do Ondrive foi fazer o download do arquivo Excel que está no Ondrive, e depois importar o arquivo salvo localmente.\nPara fazer o download e abrir um arquivo Excel, podemos usar o método `download_file()` para baixar o arquivo, e então a função `readxl::read_excel()` para importar o arquivo:\n\n``` r\n# baixar o arquivo\nonedrive_da_bea$download_file(\"pasta_de_exemplo/pinguins.xlsx\", \n                              dest = \"pinguins_onedrive.xlsx\")\n\n# ler o arquivo baixado\npinguins_do_onedrive <- readxl::read_excel(\"pinguins_onedrive.xlsx\")\ndplyr::glimpse(pinguins_do_onedrive)\n#>  Rows: 344\n#>  Columns: 8\n#>  $ especie               <chr> \"Pinguim-de-adélia\", \"Pinguim-de-adé…\n#>  $ ilha                  <chr> \"Torgersen\", \"Torgersen\", \"Torgersen…\n#>  $ comprimento_bico      <dbl> 39.1, 39.5, 40.3, NA, 36.7, 39.3, 38…\n#>  $ profundidade_bico     <dbl> 18.7, 17.4, 18.0, NA, 19.3, 20.6, 17…\n#>  $ comprimento_nadadeira <dbl> 181, 186, 195, NA, 193, 190, 181, 19…\n#>  $ massa_corporal        <dbl> 3750, 3800, 3250, NA, 3450, 3650, 36…\n#>  $ sexo                  <chr> \"macho\", \"fêmea\", \"fêmea\", NA, \"fême…\n#>  $ ano                   <dbl> 2007, 2007, 2007, 2007, 2007, 2007, …\n```\n\nCaso queira abrir o arquivo no navegador (para ver, compartilhar ou coisas similares), use o método `open_item()`, informando o caminho até o arquivo:\n\n``` r\nonedrive_da_bea$open_item(path = \"pasta_de_exemplo/pinguins.xlsx\") \n```\n\n## Conclusão\n\nEspero que este post seja útil para quem usa o One Drive também.\nTambém espero que o pacote seja aprimorado para conseguir importar os dados sem que seja necessário baixá-los.\n\nCaso você encontre algum método melhor para importar os dados, [conta pra gente](https://discourse.curso-r.com/)!\n\nAté a próxima!\n\n## Referências\n\n-   [Documentação do pacote Microsoft365R - Vignette sobre o OneDrive](https://cran.r-project.org/web/packages/Microsoft365R/vignettes/od_sp.html)\n\n-   [GitHub do pacote Microsoft365R](https://github.com/Azure/Microsoft365R)\n\n-   [Referência da base dos pinguins](https://allisonhorst.github.io/palmerpenguins/)\n\n-   Avançado: Referências sobre classes R6 em R\n\n    -   [Documentação do pacote R6](https://r6.r-lib.org/articles/Introduction.html)\n    -   [Livro Advanced R](https://adv-r.hadley.nz/r6.html)\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}